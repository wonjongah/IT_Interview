두 개 이상의 테이블에서 조인을 사용하지 않고 연관된 데이터를 조회하는 방법 중에 또 다른 방법이 있는데 바로 집합 연산자를 사용하는 방법이다.

<u>집합 연산자는 여러 개의 질의의 결과를 연결해서 하나로 결합하는 방식을 사용한다.</u>

즉, 집합 연산자는 2개 이상의 질의 결과를 하나의 결과로 만들어준다.

<u>일반적으로 집합 연산자를 사용하는 상황은 서로 다른 테이블에서 유사한 형태의 결과를 반환하는 것을 하나의 결과로 합치고자 할 때와 동일 테이블에서 서로 다른 질의를 수행해 결과를 합치고자 할 때 사용할 수 있다. 이외에도 튜닝 관점에서 실행 계획을 분리하고자 하는 목적으로도 사용할 수 있다.</u>

<u>집합 연산자를 사용하기 위해서는 SELECT 절의 칼럼 수가 동일하고, SELECT 절의 동일 위치에 존재하는 칼럼의 데이터 타입이 상호 호환 가능해야 한다.</u> 그렇지 않으면 데이터베이스가 오류를 반환한다.



##### 집합 연산자의 종류

| 집합 연산자                                    | 연산자의 의미                                                |
| ---------------------------------------------- | ------------------------------------------------------------ |
| UNION                                          | 여러 개의 SQL 문의 결과에 대한 합집합으로 결과에서 모든 중복된 행은 하나의 행으로 만든다. |
| UNION ALL (정렬하지 않기 위해 쓸 경우도 있다.) | <u>여러 개의 SQL문의 결과에 대한 합집합으로 중복된 행도 그대로 결과로 표시된다.</u> 즉, 단순히 결과만 합쳐놓은 것이다. 일반적으로 여러 질의 결과가 상호 배타적일 때 많이 사용한다. 개별 SQL문의 결과가 서로 중복되지 않는 경우, UNION과 결과가 동일하다. |
| INTERSECT                                      | 여러 개의 SQL문의 결과에 대한 교집합이다. 중복된 행은 하나의 행으로 만든다. |
| EXCEPT                                         | 앞의 SQL문의 결과에서 뒤의 SQL문의 결과에 대한 차집합이다. 중복된 행은 하나의 행으로 ㅁ나든다. |

UNION ALL은 두 집합을 모두 합한 것이라고 생각하면 된다.

EX) A = {1, 2, 2, 2, 3} UNION ALL B = {1, 1, 2, 5, 6} => {1, 2, 2, 2, 3, 1, 1, 2, 5, 6}

UNION은 중복 제거.



집합 연산자를 상요해서 만들어지는 SQL 문의 형태는 다음과 같다.

```SQL
SELECT 칼럼명1, 칼럼명2, ...
FROM 테이블명1
[WHERE 조건식]
[[GROUP BY 칼럼이나 표현식
[HAVING 그룹조건식]]
집합연산자
SELECT 칼럼명1, 칼럼명2, ...
FROM 테이블명2
[WHERE 조건식]
[[GROUP BY 칼럼이나 표현식
[HAVING 그룹조건식]]
[ORDER BY 1, 2 [ASC 또는 DESC]];
```

EX)

```SQL
SELECT PLYAER_NAME 선수명, BACK_NO 백넘버
FROM PLAYER
WHERE TEAM_ID = 'K02'
UNION
SELECT PLYAER_NAME 선수명, BACK_NO 백넘버
FROM PLAYER
WHERE TEAM_ID = 'K07'
ORDER BY 1;
```

집합 연산자는 사용상의 제약조건을 만족한다면 어떤 형태의 SELECT문이라도 이용할 수 있다.

집합 연산자는 여러 개의 SELECT문을 연결하는 것에 지나지 않는다.

ORDER BY는 집합 연산을 적용한 최종 결과에 대한 정렬처리이므로 가장 마지막 줄에 한 번만 기술한다.



EX) 집합 연산자를 이용한 질문

```
1. K-리그 소속 선수들 중에서 소속이 삼성블루윙즈팀인 선수들과 전남드레곤즈팀인 선수들에 대한 내용 모두 보고 싶다.
=> 둘의 합집합

2. K-리그 소속 선수들 중에서 소속이 삼성블루윙즈팀인 선수들과 포지션이 골키퍼인 선수들을 모두 보고 싶다.
=> 둘의 합집합

3. K-리그 소속 선수들에 대한 정보 중에서 포지션별 평균키와 팀별 평균키를 알고 싶다.
=> 포지션별 평균키와 팀별 평균키의 합집합

4. K-리그 소속 선수들 중에서 소속이 삼성블루윙즈팀이면서 포지션이 미드필더가 아닌 선수들의 정보를 보고 싶다.
=> 삼성블루윙즈팀 집합에서 미드필터 선수들의 차집합

5. K-리그 소속 선수들 중에서 소속이 삼성블루윙즈팀이면서 포지션이 골키퍼인 선수들의 정보를 알고 싶다.
=> 삼섬블루윙즈팀 집합에서 포지션 골키퍼인 선수들의 집합의 교집합
```



EX) 1. K-리그 소속 선수들 중에서 소속이 삼성블루윙즈팀인 선수들과 전남드레곤즈팀인 선수들에 대한 내용 모두 보고 싶다.

```SQL
SELECT TEAM_ID 팀코드, PLAYER_NAME 선수명, POSITION 포지션, BACK_NO 백넘버, HEIGHT 키
FROM PLAYER
WHERE TEAM_ID = 'K02'
UNION
SELECT TEAM_ID 팀코드, PLAYER_NAME 선수명, POSITION 포지션, BACK_NO 백넘버, HEIGHT 키
FROM PLAYER
WHERE TEAM_ID = 'K07'; 
```

```
팀코드 선수명                                   포지션                   백넘버
------ ---------------------------------------- -------------------- ----------
        키
----------
K02    최건하                                   FW                           18
       180

K02    최호진                                   GK                           31
       190

K02    코샤                                     DF



팀코드 선수명                                   포지션                   백넘버
------ ---------------------------------------- -------------------- ----------
        키
----------
K02    하태근                                   MF                           29
       182

K07    강철                                     DF                            3
       178

K07    김반                                     MF                           14
       174
```



첫 번째 질문에 대한 SQL문에서 삼성 블루윙즈 팀인 선수들과 전남 드레곤즈 팀의 선수들의 합집합이라는 것은 WHERE 절에 IN 또는 OR 연산자로도 변환이 가능핟.

다만 IN 또는 OR 연산자를 사용할 경우 결과의 표시 순서가 달라질 수 있다.

만약, 결과의 동일한 표시 순서를 원한다면 ORDER BY 절을 사용해서 명시적으로 정렬 순서를 정의하는 것이 좋다.



```SQL
-- OR 사용

SELECT TEAM_ID 팀코드, PLAYER_NAME 선수명, POSITION 포지션, BACK_NO 백넘버, HEIGHT 키
FROM PLAYER
WHERE TEAM_ID = 'K02' OR TEAM_ID = 'K07';

-- IN 사용

SELECT TEAM_ID 팀코드, PLAYER_NAME 선수명, POSITION 포지션, BACK_NO 백넘버, HEIGHT 키
FROM PLAYER
WHERE TEAM_ID IN ('K02', 'K07');
```

```
팀코드 선수명                                   포지션                   백넘버
------ ---------------------------------------- -------------------- ----------
        키
----------
K07    찌코                                     FW                           27
       180

K07    하성룡                                   FW                           35
       179

K07    홍복표                                   FW                           19
       182


팀코드 선수명                                   포지션                   백넘버
------ ---------------------------------------- -------------------- ----------
        키
----------
K02    김반코비                                 MF                           47
       185

K02    김선우                                   FW                           33
       174

K02    김여성                                   MF                           36
       179
```

